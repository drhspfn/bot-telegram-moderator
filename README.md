# Telegram Модератор Бот

Цей бот розроблений для автоматизації модерації Telegram-каналів. Він надає адміністраторам широкий набір інструментів для підтримки порядку та створення комфортного середовища для спілкування.

## Можливості

### Для адміністраторів

*   **Модерація повідомлень:**
    *   Автоматичне видалення повідомлень, що містять нецензурну лексику (використовується ML модель для визначення).
    *   Блокування посилань у повідомленнях.
    *   Можливість видавати користувачам попередження (варни).
    *   Можливість мутити або банити користувачів.
    *   Налаштування кількості попереджень для автоматичного муту/бану.
    *   Налаштування тривалості муту/бану.
*   **Привітання нових користувачів:**
    *   Автоматичне відправлення вітального повідомлення при вході нового користувача в чат.
    *   Можливість вказати посилання на правила чату (наприклад, Telegraph).
    *   Кулдаун на прийняття правил (за замовчуванням 2 хвилини).
    *   Можливість відключити привітання та кулдаун.
*   **Керування чатами:**
    *   Перегляд списку чатів, де ви є адміністратором (/my\_chats в особистих повідомленнях).
    *   Налаштування модерації для кожного чату окремо.

### Для звичайних користувачів

*   `/coin` - підкинути монетку.
*   `/dice` - кинути гральний кубик.
*   `/cat_gif` - отримати випадкову GIF-анімацію з котиком.
*   **Прийняття правил:** Після входу в чат, користувач має прийняти правила, щоб мати можливість писати повідомлення.

### Команди в особистих повідомленнях

*   `/my_chats` - перегляд списку чатів, де ви є адміністратором, та можливість налаштування цих чатів.

## Як це працює

1.  **Модерація повідомлень:**
    *   Бот аналізує кожне повідомлення на наявність заборонених слів за допомогою навченої ML моделі.
    *   Якщо виявляє заборонене слово, видаляє повідомлення та додає користувачеві 1 варн.
    *   Заборона посилань працює за простим принципом виявлення посилань в повідомленні.
2.  **Система попереджень:**
    *   Попередження видаються за використання заборонених слів або посилання.
    *   Користувач отримує попередження від бота.
    *   Після досягнення певної кількості попереджень (за замовчуванням 3), бот автоматично застосовує покарання (мут або бан).
3.  **Привітання та правила:**
    *   При вході нового користувача бот надсилає вітальне повідомлення та пропонує ознайомитися з правилами.
    *   Користувач має 2 хвилини (за замовчуванням) на прийняття правил, після чого він зможе писати в чат.

## Налаштування та Деплой

### Крок 1: Налаштування оточення

Створіть файл `.env` у кореневій директорії проекту та заповніть його наступними змінними:

```env
DATABASE_URL="mysql+aiomysql://username:password@host/database"
BOT_TOKEN="ВАШ_ТОКЕН_БОТА"
API_ID=ВАШ_API_ID
API_HASH="ВАШ_API_HASH"
TENOR_API_KEY="LIVDSRZULELA"
```

*   `DATABASE_URL`: Рядок підключення до бази даних MySQL.
*   `BOT_TOKEN`: Токен вашого Telegram-бота, який можна отримати у @BotFather.
*   `API_ID` та `API_HASH`: Отримайте їх на [my.telegram.org](https://my.telegram.org).
    1. Перейдіть на сайт [my.telegram.org](https://my.telegram.org).
    2. Увійдіть у свій обліковий запис Telegram.
    3. Перейдіть на вкладку "API development tools".
    4. Створіть нову програму (Create new application), надайте їй назву, виберіть тип "Desktop" або "Web", та заповніть необхідні поля.
    5. Після створення ви побачите свій `API_ID` та `API_HASH`.
*   `TENOR_API_KEY`: Ключ для доступу до API Tenor для отримання GIF-анімацій. Можна отримати безкоштовно на сайті [tenor.com](https://tenor.com/).

### Крок 2: Встановлення залежностей

Переконайтеся, що у вас встановлений Python 3.7+ і виконайте наступні команди для встановлення необхідних бібліотек:

```bash
pip install -r requirements.txt
```

### Крок 3: Міграція бази даних

Для застосування міграцій бази даних запустіть команду:

```bash
alembic upgrade head
```

### Крок 4: Запуск бота

Запустіть бота за допомогою команди:

```bash
python main.py
```

## Подальші кроки
### Крок 1: Додавання бота до каналу

1.  Додайте бота до вашого Telegram-каналу як адміністратора.
2.  **Обов'язково** надайте боту усі необхідні права адміністратора:
    *   Права на видалення повідомлень
    *   Права на банити та мутити користувачів
    *   Права на додавання нових користувачів
    *   Права на читання повідомлень
    *   Права на відправлення повідомлень
    *   Права на керування запрошеннями

### Крок 2: Ініціалізація бота

1.  Після додавання бота до каналу, вам потрібно скористатися командою `/init` у чаті.
2.  Ця команда ініціює процес збору необхідної інформації про канал:
    *   Список адміністраторів каналу.
    *   Список усіх учасників каналу.
    *   Інші необхідні дані для роботи бота.
3.  **Важливо!** Процес збору інформації може зайняти деякий час (близько хвилини, залежно від навантаження та кількості учасників у групі). Будьте терплячі, доки бот не завершить ініціалізацію.

### Крок 3: Подальші кроки

*   Після успішної ініціалізації ви можете почати налаштовувати правила модерації для вашого каналу через команду `/my_chats` в особистих повідомленнях.
*   Переконайтесь, що ви налаштували усі необхідні параметри для коректної роботи бота.


**Примітка:** Команда `/init` потрібна для первинного налаштування бота в кожному новому каналі. Після успішної ініціалізації бот збере необхідну інформацію, але модерація в каналі **за замовчуванням вимкнена**. Це означає, що бот не буде автоматично видаляти повідомлення, банити чи мутити користувачів доти, доки ви не увімкнете відповідні налаштування. Заборона посилань та перевірка на непристойні слова також **вимкнені за замовчуванням**. Вам потрібно буде активувати ці функції через налаштування каналу в особистих повідомленнях (`/my_chats`).

## Ліцензія

Цей проект розповсюджується під ліцензією MIT.

---
